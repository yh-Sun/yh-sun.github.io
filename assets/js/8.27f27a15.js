(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{733:function(t,s,e){"use strict";e.r(s);var a=e(105),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("p",[t._v("Prometheus 介绍")]),t._v(" "),e("p",[t._v("Prometheus是一套开源的监控&报警&时间序列数据库的组合，起始是由SoundCloud公司开发的。随着发展，越来越多公司和组织接受采用Prometheus，社区也十分活跃，他们便将它独立成开源项目，并且有公司来运作。google SRE的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。现在最常见的Kubernetes容器管理系统中，通常会搭配Prometheus进行监控。")]),t._v(" "),e("p"),t._v(" "),e("p",[t._v("Prometheus 的优点")]),t._v(" "),e("p",[t._v("1. 非常少的外部依赖，安装使用超简单")]),t._v(" "),e("p",[t._v("2. 已经有非常多的系统集成 例如：docker HAProxy Nginx JMX等等")]),t._v(" "),e("p",[t._v("3. 服务自动化发现")]),t._v(" "),e("p",[t._v("4. 直接集成到代码")]),t._v(" "),e("p",[t._v("5. 设计思想是按照分布式、微服务架构来实现的")]),t._v(" "),e("p"),t._v(" "),e("p",[t._v("Prometheus 的特性")]),t._v(" "),e("p",[t._v("1. 自定义多维度的数据模型")]),t._v(" "),e("p",[t._v("2. 非常高效的存储 平均一个采样数据占 ~3.5 bytes左右，320万的时间序列，每30秒采样，保持60天，消耗磁盘大概228G。")]),t._v(" "),e("p",[t._v("3. 强大的查询语句")]),t._v(" "),e("p",[t._v("4. 轻松实现数据可视化")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/TheSunnn/md-pages/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/1616047231902.png",alt:""}}),t._v(" "),e("img",{attrs:{src:"https://yh-sun.github.io/note-cloud/1618374354163.png",alt:"enter description here"}})]),t._v(" "),e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),e("p",[e("strong",[t._v("==全局路径：/home/sun/app_store==")])]),t._v(" "),e("h3",{attrs:{id:"node-exporter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter"}},[t._v("#")]),t._v(" node_exporter")]),t._v(" "),e("blockquote",[e("p",[t._v("源码地址：https://github.com/prometheus/node_exporter")])]),t._v(" "),e("p",[t._v("在下载安装Prometheus之前我们先安装node_exporter插件，用于提供服务器监控的指标(比如：CPU、内存、磁盘、磁盘读写速率等指标)，是一个非常常用的Prometheus Client插件。")]),t._v(" "),e("p",[e("strong",[t._v("1.下载")])]),t._v(" "),e("div",{staticClass:"language-awk extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("wget -c https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz\n")])])]),e("p",[e("strong",[t._v("2.解压")])]),t._v(" "),e("div",{staticClass:"language-css extra-class"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[t._v("tar -zxvf node_exporter-0.18.1.linux-amd64.tar.gz\nmv node_exporter-0.18.1.linux-amd64 node_exporter\ncd node_exporter\n")])])]),e("p",[e("strong",[t._v("3.后台运行")])]),t._v(" "),e("div",{staticClass:"language-lsl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("nohup ./node_exporter  > ./node_exporter.stdout 2>&1 &\n")])])]),e("p",[e("img",{attrs:{src:"https://gitee.com/TheSunnn/md-pages/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/1616050255276.png",alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("4.启动")])]),t._v(" "),e("div",{staticClass:"language-x86asm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:9100/metrics\n")])])]),e("h3",{attrs:{id:"mysql-exporter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-exporter"}},[t._v("#")]),t._v(" mysql_exporter")]),t._v(" "),e("p",[t._v("==推荐图标ID：https://grafana.com/dashboards/7362==\n"),e("strong",[t._v("1.下载")])]),t._v(" "),e("div",{staticClass:"language-awk extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("wget -c https://github.com/prometheus/mysqld_exporter/releases/download/v0.12.1/mysqld_exporter-0.12.1.linux-amd64.tar.gz\n")])])]),e("p",[e("strong",[t._v("2.解压")])]),t._v(" "),e("div",{staticClass:"language-css extra-class"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[t._v("tar -zxvf mysqld_exporter-0.12.1.linux-amd64.tar.gz\nmv mysqld_exporter-0.12.1.linux-amd64 mysqld_exporter\ncd mysqld_exporter\n")])])]),e("p",[e("strong",[t._v("3.配置")])]),t._v(" "),e("div",{staticClass:"language-x86asm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("vi .my.cnf\n\n[client]\nhost=10.1.10.100\nport=3306\nuser=kscd_dev\npassword=Kscd_dev@123\n")])])]),e("p",[e("strong",[t._v("4.后台运行")])]),t._v(" "),e("div",{staticClass:"language-lsl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('nohup ./mysqld_exporter --web.listen-address=":9104" --config.my-cnf=./.my.cnf &\n')])])]),e("p",[e("img",{attrs:{src:"https://gitee.com/TheSunnn/md-pages/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/1616052397756.png",alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("5.启动")])]),t._v(" "),e("div",{staticClass:"language-x86asm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:9104\n")])])]),e("h3",{attrs:{id:"prometheus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[t._v("#")]),t._v(" prometheus")]),t._v(" "),e("p",[t._v("> 下载地址：https://prometheus.io/download/\n \n"),e("strong",[t._v("下载")]),t._v("\n > 下载版本号为2.13.0，也可以根据自己需要下载其他版本")]),t._v(" "),e("div",{staticClass:"language-awk extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("wget -c https://github.com/prometheus/prometheus/releases/download/v2.13.0/prometheus-2.13.0.linux-amd64.tar.gz\n")])])]),e("p",[e("strong",[t._v("解压")])]),t._v(" "),e("div",{staticClass:"language-css extra-class"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[t._v("tar -zxvf prometheus-2.13.0.linux-amd64.tar.gz\nmv prometheus-2.13.0.linux-amd64 prometheus\ncd prometheus\n")])])]),e("p",[e("strong",[t._v("配置")])]),t._v(" "),e("div",{staticClass:"language-css extra-class"},[e("pre",{pre:!0,attrs:{class:"language-css"}},[e("code",[t._v("vi prometheus.yml\n\n"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("scrape_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prometheus'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ["),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9090'")]),t._v("]\n\n  - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_exporter'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ["),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9100'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.1.10.99:9100'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10.1.10.100:9100'")]),t._v("]\n\n  - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      - "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ["),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9104'")]),t._v("]\n")])])]),e("p",[e("strong",[t._v("后台运行")])]),t._v(" "),e("div",{staticClass:"language-jboss-cli extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("nohup ./prometheus --config.file=prometheus.yml &\n")])])]),e("p",[e("strong",[t._v("启动")])]),t._v(" "),e("div",{staticClass:"language-x86asm extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://localhost:9090\n")])])]),e("p",[t._v("insert metric at cursor里面是prometheus监控的指标\nStatus -> Targets是监控的目标节点\n"),e("img",{attrs:{src:"https://gitee.com/TheSunnn/md-pages/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/1616054356264.png",alt:""}})]),t._v(" "),e("p"),t._v(" "),e("h3",{attrs:{id:"prometheus报-warning-error-fetching-server-time-detected-1518-seconds-time-difference-between-your-browser-and-the-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus报-warning-error-fetching-server-time-detected-1518-seconds-time-difference-between-your-browser-and-the-server"}},[t._v("#")]),t._v(" Prometheus报 Warning: Error fetching server time: Detected 1518 seconds time difference between your browser and the server.")]),t._v(" "),e("div",{staticClass:"language-stylus extra-class"},[e("pre",{pre:!0,attrs:{class:"language-stylus"}},[e("code",[t._v("到装prometheus的机器上，同步一下时钟：\n\n"),e("span",{pre:!0,attrs:{class:"token property-declaration"}},[e("span",{pre:!0,attrs:{class:"token property"}},[t._v("ntpdate")]),t._v(" time3.aliyun.com")]),t._v("\n")])])]),e("h2",{attrs:{id:"第二次安装-成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二次安装-成功"}},[t._v("#")]),t._v(" 第二次安装，成功")]),t._v(" "),e("p",[t._v("==D:\\AppStore\\Prometheus==")]),t._v(" "),e("h3",{attrs:{id:"grafana"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[t._v("#")]),t._v(" grafana")]),t._v(" "),e("ol",[e("li",[t._v("wget https://dl.grafana.com/oss/release/grafana-7.5.4-1.x86_64.rpm")]),t._v(" "),e("li",[t._v("sudo yum install grafana-7.5.4-1.x86_64.rpm")]),t._v(" "),e("li",[t._v("find / -name '"),e("em",[t._v("grafana")]),t._v("'")]),t._v(" "),e("li",[t._v("cd /usr/share/grafana/")]),t._v(" "),e("li",[t._v("find / -name '"),e("em",[t._v("grafana-server")]),t._v("'")]),t._v(" "),e("li",[t._v("grafana-server web")])]),t._v(" "),e("blockquote",[e("p",[t._v("3 4 5 没啥用，yum装完不用配置环境变量，直接执行grafana-server web &后台启动就可以了")])]),t._v(" "),e("div",{staticClass:"language-lsl extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("修改默认3000端口为9091\nvi defaults.ini \n")])])]),e("p",[t._v("优秀的图标ID：11074（node 英文）、8919（node 中文）")]),t._v(" "),e("h3",{attrs:{id:"prometheus-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-2"}},[t._v("#")]),t._v(" prometheus")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" prometheus.yml\n\n\nscrape_configs:\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),t._v("\n  - job_name: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prometheus'")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# metrics_path defaults to '/metrics'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# scheme defaults to 'http'.")]),t._v("\n\n    static_configs:\n    - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9090'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  - job_name: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'linux'")]),t._v("\n    static_configs:\n    - targets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9100'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      labels:\n        instance: node1\n")])])]),e("p",[e("strong",[t._v("😉后面的node_exporter也都没啥特殊的，安装方式与第一次相同。但就是成功了，嘿嘿嘿！")])])])}),[],!1,null,null,null);s.default=r.exports}}]);