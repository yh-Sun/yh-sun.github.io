(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{743:function(t,s,a){"use strict";a.r(s);var e=a(105),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"rocketmq部署、运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq部署、运行"}},[t._v("#")]),t._v(" RocketMQ部署、运行")]),t._v(" "),a("blockquote",[a("p",[t._v("本次采用在10.1.1.100，部署RocketMQ，想适用的小伙伴请自行链接VPN")])]),t._v(" "),a("ul",[a("li",[t._v("下载RocketMQ")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("rocketMQ执行包（二进制文件即可，不用再次编译）：\n\t直接去apache rocketmq官网下即可，本次选择：rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("all"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.7")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zip\nrocketMQ控制台：\n\tgit clone https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("externals\n")])])]),a("ul",[a("li",[t._v("运行RocketMQ程序：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('cd bin\n\nvim runserver.sh 、vim runbroker.sh\n\n# 找到如下配置\nJAVA_OPT="${JAVA_OPT} -server -Xms8g -Xmx8g -Xmn4g"\n# 修改成你可以接受的范围\nJAVA_OPT="${JAVA_OPT} -server -Xms512m -Xmx521m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m"\n\n# 由于kscd账户配置的环境变量在~/.bash_profile，默认无法识别，所以需要手动指定jdk路径\n1.首先注释掉，以下三行\n# [ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=$HOME/jdk/java\n# [ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=/usr/java\n# [ ! -e "$JAVA_HOME/bin/java" ] && error_exit "Please set the JAVA_HOME variable in your environment, We need java(x64)!"\n2.手动配置JDK路径\nexport JAVA_HOME=/home/kscd/jdk1.8\n')])])]),a("ul",[a("li",[t._v("配置环境变量")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vi ~/.bash_profile\n\n# 将如下配置加到最后一行\nexport NAMESRV_ADDR=127.0.0.1:9876\n\nsource ~/.bash_profile\n")])])]),a("ul",[a("li",[t._v("启动Name Server")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd /home/kscd/RocketMQ/rocketmq/bin\n\nnohup sh mqnamesrv > /home/kscd/RocketMQ/logs/server.log &\n\n# 检测是否启动成功\n[kscd@localhost bin]$ tail -f /home/kscd/RocketMQ/logs/server.log\nJava HotSpot(TM) 64-Bit Server VM warning: Using the DefNew young collector with the CMS collector is deprecated and will likely be removed in a future release\nJava HotSpot(TM) 64-Bit Server VM warning: UseCMSCompactAtFullCollection is deprecated and will likely be removed in a future release.\nThe Name Server boot success. serializeType=JSON\n\n\n\n# 顺便说下停止命令\n[kscd@localhost bin]$ sh mqshutdown namesrv\nThe mqnamesrv(36838) is running...\nSend shutdown request to mqnamesrv(36838) OK\n")])])]),a("ul",[a("li",[t._v("启动Broker")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RocketMQ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin\n\nnohup sh mqbroker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v(" autoCreateTopicEnable"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RocketMQ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("broker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检测是否启动成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@localhost")]),t._v(" bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ tail "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RocketMQ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("broker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("The")]),t._v(" broker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localdomain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".4")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".194")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10911")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" boot success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" serializeType"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" name server is localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 顺便说下停止命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@localhost")]),t._v(" bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ sh mqshutdown broker\n")])])]),a("ul",[a("li",[t._v("启动控制台")])]),t._v(" "),a("div",{staticClass:"language-ruby extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 由于本次采用的是git clone打包的启动方式，还是要啰嗦一句：“修改的两处配置文件”")]),t._v("\ncd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("externals"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("resources\n\nvim application"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("properties\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改如下配置")]),t._v("\nserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" 服务端口号\nrocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namesrvAddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" 配置服务地址\n\nrocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dataPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tmp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" mq数据路径，可以自己修改\n\ncd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("externals"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("console\n\nmvn clean package "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Dmaven")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("skip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\nnohup java "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jar rocketmq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("console"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ng"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namesrvAddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9876")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志默认位置：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kscd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RocketMQ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nohup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out\n")])])]),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("ul",[a("li",[t._v("运行")]),t._v(" "),a("li",[t._v("笔者记录")])]),t._v(" "),a("blockquote",[a("p",[t._v("控制台：http://10.1.1.100:8080/")])]),t._v(" "),a("blockquote",[a("p",[t._v("兄弟姐妹们，欢迎一起踩坑："),a("a",{attrs:{href:"https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/rocketmq-example/readme-zh.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("RocketMQ Example"),a("OutboundLink")],1)])]),t._v(" "),a("hr"),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rocketmq-producer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("topic1\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# java(MessageBuilder.setHeader(TAGS, "tabObj"))')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rocketmq-consumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rocketmq.bindings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("input3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("consumer.tags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tagObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#订阅 带tag值为tabObj的字符串")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("topic1\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);